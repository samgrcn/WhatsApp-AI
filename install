#!/bin/bash

# Change to the directory where the script is located
cd "$(dirname "$0")"

# Welcome message
echo "Welcome to the Oompf! Fitness WhatsApp Auto-Responder Setup!"
echo "This script will guide you through the installation process."

# Check if Node.js is installed
if ! command -v node &> /dev/null; then
    echo "Node.js is not installed. Installing Node.js..."
    # Check if apt is available (Debian-based systems)
    if command -v apt-get &> /dev/null; then
        sudo apt-get update
        sudo apt-get install -y nodejs
    else
        echo "Unsupported package manager. Please install Node.js manually from https://nodejs.org/"
        exit 1
    fi
fi

# Install dependencies
echo "Installing dependencies..."
npm install

# Create data directory and messages.json file
echo "Creating data directory and messages.json file..."
mkdir -p data
echo "[]" > data/messages.json

# Prompt for DeepSeek API key
echo "Please enter your DeepSeek API key:"
read deepseek_api_key

# Create .env file with the API key
echo "DEEPSEEK_API_KEY=$deepseek_api_key" > .env

# Make setup.sh executable
chmod +x setup.sh

# Run the setup script
./setup.sh

# Start the application
echo "Starting the application..."
npm start

# Keep the terminal open if there is an error
if [ $? -ne 0 ]; then
    echo "An error occurred. Press Enter to exit."
    read 